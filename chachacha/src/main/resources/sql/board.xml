<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="Boards">
	<select id="count" resultType="int">
		select count(*) from board
	</select>
	
	<select id="boardList" parameterType="Map" resultType="board">
		select * from( select rownum rnum, b.*
		from(select *
		from board
		order by BOARD_RE_REF desc,
		BOARD_RE_SEQ asc) b
		)
		where rnum &gt;=#{startrow} and rnum &lt;=#{endrow}
	</select>
	
	<insert id="insert" parameterType="board">
		<selectKey resultType="int" order="BEFORE" keyColumn="BOARD_NUM" keyProperty="BOARD_NUM">
			select nvl(max(BOARD_NUM),0)+1 from board
		</selectKey>
		
		insert into board
		(BOARD_NUM,
		 BOARD_NAME, BOARD_PASS, BOARD_SUBJECT,
		 BOARD_CONTENT, BOARD_FILE, BOARD_ORIGINAL,
		 BOARD_RE_REF,
		 BOARD_RE_LEV, BOARD_RE_SEQ, BOARD_READCOUNT,
		 BOARD_DATE
		) values
		(#{BOARD_NUM},
		 #{BOARD_NAME}, #{BOARD_PASS}, #{BOARD_SUBJECT},
		 #{BOARD_CONTENT}, #{BOARD_FILE, jdbcType=VARCHAR}, #{BOARD_ORIGINAL, jdbcType=VARCHAR},
		 #{BOARD_NUM},
		 #{BOARD_RE_LEV}, #{BOARD_RE_SEQ}, #{BOARD_READCOUNT},
		 sysdate
		)
		
	</insert>
	
	<select id="detail" parameterType="int" resultType="board">
		select * from board where BOARD_NUM = #{number}
	</select>
	
	<update id="ReadCountUpdate" parameterType="int">
		update board 
		set BOARD_READCOUNT = 
		BOARD_READCOUNT+1 where BOARD_NUM = #{number}
	</update>
	
	<select id="BoardWriter" parameterType="map" resultType="board">
		select * from board where BOARD_NUM = #{num} and BOARD_PASS = #{pass}
	</select>
	
	<update id="modify" parameterType="board">
		update board
		set
		BOARD_SUBJECT=#{BOARD_SUBJECT},
		BOARD_CONTENT=#{BOARD_CONTENT},
		BOARD_FILE=#{BOARD_FILE, jdbcType=VARCHAR},
		BOARD_ORIGINAL=#{BOARD_ORIGINAL, jdbcType=VARCHAR}
		where BOARD_NUM=#{BOARD_NUM}
	</update>
	
	<delete id="BoardDelete" parameterType="int" >
		delete from board where BOARD_NUM = #{BOARD_NUM}
	</delete>
	
	<insert id="Reply" parameterType="board">
		<selectKey resultType="int" order="BEFORE" keyColumn="BOARD_NUM" keyProperty="BOARD_NUM">
			select nvl(max(BOARD_NUM),0)+1 from board
		</selectKey>
		
		insert into board
		(BOARD_NUM,
		 BOARD_NAME, BOARD_PASS, BOARD_SUBJECT,
		 BOARD_CONTENT,
		 BOARD_RE_REF,
		 BOARD_RE_LEV, BOARD_RE_SEQ, BOARD_READCOUNT,
		 BOARD_DATE
		) values
		(#{BOARD_NUM},
		 #{BOARD_NAME}, #{BOARD_PASS}, #{BOARD_SUBJECT},
		 #{BOARD_CONTENT},
		 #{BOARD_RE_REF},
		 #{BOARD_RE_LEV}+1, #{BOARD_RE_SEQ}+1, #{BOARD_READCOUNT},
		 sysdate
		)
		
	</insert>
	
	<update id="ReplyUpdate" parameterType="board">
		<![CDATA[
		update board set BOARD_RE_SEQ = BOARD_RE_SEQ +1
		where BOARD_RE_REF = #{BOARD_RE_REF} and BOARD_RE_SEQ > #{BOARD_RE_SEQ}
		]]>
	</update>
	
	<delete id="delete" parameterType="int">
		delete from board where BOARD_NUM=#{number}
	</delete>
	
	<delete id="deleteall" parameterType="int">
		delete from board where BOARD_RE_REF=#{number}
	</delete>
	
</mapper>